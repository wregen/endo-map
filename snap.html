
<!DOCTYPE html>
<html>
    <head>
        <title>Snap to Road - Google Maps API v3</title>
        <style type="text/css">
            html, body {margin: 0; width:100%; height: 100%; }
            #map_canvas { position:absolute; top:50px;bottom:0;left:0;right:0;}
        </style>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
        <script type="text/javascript">
            var map, path = new google.maps.MVCArray(), service = new google.maps.DirectionsService(), shiftPressed = false, poly;

            google.maps.event.addDomListener(document, "keydown", function (e) {
                shiftPressed = e.shiftKey;
            });
            google.maps.event.addDomListener(document, "keyup", function (e) {
                shiftPressed = e.shiftKey;
            });

            function Init() {
                var myOptions = {
                    zoom: 13,
//                    mapTypeId: google.maps.MapTypeId.HYBRID,
                    mapTypeControlOptions: {
                        mapTypeIds: [google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.HYBRID, google.maps.MapTypeId.SATELLITE]
                    },
                    disableDoubleClickZoom: true,
                    scrollwheel: false,
                    draggableCursor: "crosshair"
                }

                map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
                showMyLocation(map) ;
                poly = new google.maps.Polyline({map: map});
                google.maps.event.addListener(map, "click", function (evt) {
                    if (shiftPressed || path.getLength() === 0) {
                        path.push(evt.latLng);
                        if (path.getLength() === 1) {
                            poly.setPath(path);
                        }
                    } else {
                        service.route({origin: path.getAt(path.getLength() - 1), destination: evt.latLng, travelMode: google.maps.DirectionsTravelMode.WALKING}, function (result, status) {
                            if (status == google.maps.DirectionsStatus.OK) {
                                for (var i = 0, len = result.routes[0].overview_path.length; i < len; i++) {
                                    path.push(result.routes[0].overview_path[i]);
                                }
                            }
                        });
                    }
                });

                function showMyLocation(map) {
                    // Try HTML5 geolocation
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function (position) {
                            var pos = new google.maps.LatLng(position.coords.latitude,
                                    position.coords.longitude);

                            var current = new google.maps.Marker({
                                map: map,
                                position: pos
                            });

                            map.setCenter(pos);
                        }, function () {
                            handleNoGeolocation(true, map);
                        });
                    } else {
                        // Browser doesn't support Geolocation
                        handleNoGeolocation(false, map);
                    }
                }

                function clearAllPolylines() {
                    for (var i = 0; i < polylines.length; ++i) {
                        polylines[i].setMap(null);
                    }
                    polylines = [];
                }

                function handleNoGeolocation(errorFlag, map) {
                    if (errorFlag) {
                        console.log('Error: The Geolocation service failed.');
                    } else {
                        console.log('Error: Your browser doesn\'t support geolocation.');
                    }

                    var options = {
                        map: map,
                        position: new google.maps.LatLng(60, 105),
                        content: content
                    };
                    map.setCenter(options.position);
                }

            }
        </script>
    </head>
    <body onload="Init()">
        <p style="margin:0;padding:10px;">Draw the route on the map. Hold shift to prevent a line segment from snapping to roads.</p>
        <div id="map_canvas"></div>
    </body>
</html>